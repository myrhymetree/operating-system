# 장치 관리

## 8.1 장치의 개념

1. 컴퓨터 시스템의 장치
    - CPU와 메모리 : 프로세스를 실행시키기 위한 필수 요소
    - 디스크 드라이브, 키보드, 마우스, 비디오 디스플레이, 프린터 등 : 데이터 입력이나 출력에 사용되는 입출력 장치
2. 입출력장치의 구분
    - 전용장치 : 한 번에 단지 하나의 프로세스에만 할당
    - 공용장치 : 여러 프로세스에 동시에 할당
    - 가상장치 : 디스크 등 공유가 가능한 장치를 이용하여 전용장치를 공용장치처럼 보이게 하여 여러 프로세스에 할당

## 8.2 장치의 구성

1. 논리적 구성
    - 하드웨어(장치, 장치제어기), 운영체제(장치 드라이버)
    - 장치 제어기 : 장치를 직접적으로 다루는 전자장치
    - 장치드라이버 : 응용 프로그램이 요청한 일반적인 입출력 요청을 해당 장치에 맞도록 변환

1. 물리적 구성
    - CPU, 메모리, 입출력 장치들이 버스로 연결
    - CPU는 장치제어기의 레지스터를 이요하여 장치에 명령을 보내거나 장치의 상태를 확인
    - 메모리 사상 입출력 : 메모리의 특정 영역을 장치 제어기의 레지스터와 대응시켜 둠. 메모리를 읽고 쓰는 것으로 장치 제어기의 레지스터를 읽고 쓰는 것과 동일한 효과

## 8.3 입출력 처리 유형

### 8.3.1 프로그램 방법

1. CPU만을 이용하여 입출력을 처리하는 것으로 폴링을 이용
2. 폴링(polling)
    - CPU가 입출력 장치의 상태를 지속적으로 확인하여 CPU가 원하는 상태가 될 때 까지 기다리는 것
3. CPU 낭비가 심해 비효율적임

### 8.3.2 인터럽트 방법

1. 입출력 처리에 인터럽트를 이용
2. 인터럽트(interrupt)
    - 어떤 장치가 다른 장치의 작업을 중단시키고 자신의 상태를 알리는 기능
3. 인터럽트 처리과정
    - 입출력 장치가 가용한 상태가 되었다고 인터럽트를 담당하는 인터럽트 제어기에 신호를 보냄
    - 인터럽트 제어기는 CPU에 인터럽트 신호를 보냄
    - CPU는 현재 실행 중이던 명령만 마치고 즉시 인터럽트에 응답
    - 인터럽트 제어기는 이벤트 대상에 대한 정보를 CPU에 보냄
    - CPU는 현재 상태를 보관하고 필요한 입출력 처리를 한 후 원래 프로세스 실행상태로 복귀

### 8.3.3 DMA 방법
![image](https://github.com/myrhymetree/operation-system/assets/94158097/d82bfe55-cbd8-4ca6-a8d6-2d0046b10bc3)
*DMA 처리과정 출처 : https://medium.com/@boutnaru/dma-direct-memory-access-a1bdc7ee44a3*

1. 입출력 처리에 DMA를 이용
2. DMA(direct memory access)
    - DMA 제어기를 이용하여 CPU를 통하지 않고 직접 메모리에 접근하여 데이터를 전송하는 방법
3. DMA 처리과정
    - CPU는 입출력에 필요한 정보를 DMA 제어기로 넘김
    - DMA 제어기는 소스에서 목적지로 데이터를 보내도록 장치제어기에 요청(CPU가 처음에 지시한 양이 될 때까지 반복)
    - 원하는 양의 입출력이 끝나면 DMA 제어기는 인터럽트 제어기에 신호를 보내 인터럽트를 발생시켜 CPU에게 입출력 작업이 모두 끝났음을 알림
4. 장점
    - 인터럽트 발생 횟수를 단 한번으로 줄여 CPU의 효율 증대
5. 사이클 스틸링
    - CPU와 DMA 제어기 모두 메모리를 액세스하려는 경우 DMA 제어기에 우선권을 주는 것

### 8.4 입출력 관리

### 8.4.1 버퍼링

1. 버퍼(buffer)
    - 입출력 데이터 등의 정보를 전송할 때 일시적으로 데이터 저장 장소로 사용되는 메모리의 일부
2. 버퍼링
    - CPU의 데이터 처리 속도와 데이터 전송 속도의 차이로 인한 문제를 버퍼를 통해 해결
3. 단일 버퍼링
    - 하나의 버퍼 이용
    - 입력장치가 데이터를 버퍼에 저장하면 CPU는 그 데이터를 처리하고 다시 입력장치가 다음 데이터를 저장하면 CPU가 또 처리하는 방식
    - 저장과 처리를 동시에 할 수 없어 비효율적
4. 이중 버퍼링
    - 두 개의 버퍼 이용(플립플롭 버퍼링)
    - 첫째 버퍼에 데이터를 저장하는 동안 둘째 버퍼의 데이터를 처리할 수 있고, 둘째 버퍼에 데이터를 저장하는 동안 첫째 버퍼에 있는 데이터를 처리할 수 있음
5. 순환 버퍼링
    - 여러 개의 버퍼를 이용하여 돌아가면서 사용

### 8.4.2 스풀링

1. 스풀링
    - 입출력 프로세스와 저속 입출력 장치 사이의 데이터 전송을 자기 디스크와 같은 고속 장치를 통하도록 하는 것
    - 일종의 버퍼링
2. 장점
    - 프로세스 입장에서는 입출력 작업이 빨리 끝나게 됨
    - 전용 장치를 공용장치처럼 보이게 하는 가상장치로 변화시킴
