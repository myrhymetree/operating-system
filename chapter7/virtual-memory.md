# 7.가상메모리

## 7.1 가상 메모리의 개념
1. 가상메모리(virtual memory)
  - 컴퓨터 시스템의 메모리 크기보다 더 큰 기억공간이 필요한 프로세스를 실행할 수 있게 하는 방법
  - 핵심은 실행 중인 프로세스에 의해 참조되는 주소(가상주소)를 메모리에서 사용하는 주소(실주소)와 분리하는 것
2. 사상(mapping)
  - 가상주소를 실주소로 변환하는 과정
3. 동적 주소 변환
  - 프로세스가 실행되는 동안 가상주소를 실주소로 바꾸는 절차
  - 주소 변환 사상표를 이용
4. 인위적 연속성
  - 가상주소 공간에서 연속인 주소가 실주소공간에서도 연속일 필요는 없음

## 7.2 블록 단위 주소 변환
1. 항목별(바이트나 워드 단위) 변환의 문제점
  - 변환에 필요한 정보량이 많아 비효율적임
2. 블록 사상 시스템
  - 정보를 블록 단위로 분류하여 각 블록이 메모리의 어디에 위치하는지만을 관리
  - 가상주소 ｖ= (ｂ, ｄ): b는 블록 번호, d는 블록의 시작점으로부터의 변위
3. 블록 구성 방식
  - 페이지 : 블록의 크기가 동일
  - 세그먼트 : 블록의 크기가 다름

## 7.2.1 페이징 기법
1. 페이징 기법
   - 가상 메모리를 페이지 단위로 나누어 관리하는 기법
2. 페이지 프레임
   - 가상 메모리의 동일한 고정된 크기로 분할된 메모리 영역의 블록
   - 가상 메모리 상의 페이지를 담을 수 있도록 실제 메모리에 틀(frame)을 만들어 둔 것
3. 페이지 사상표
   - 프로세스가 사용하는 가상주소를 메모리에 적재된 후에도 바로 찾을 수 있도록 실주소로 동적 변환을 할 수 있게 함.
   - 가상주소의 페이지 번호별 저장 정보 : 실주소의 페이지 프레임 번호, 현재 메모리에 존재하는지의 여부 비트값, 보조기억장치의 주소
4. 동적 주소 변환
   - 직접 사상 : 페이지 사상표를 직접 이용하여 동적 주소 변환
   - 연관 사상 : 페이지 변환 정보를 연관 기억장치에 저장한 연관 사상표를 이용하여 동적 주소 변환
   - 연관 / 직접 사상 : 연관 사상표에는 가장 최근에 참조된 페이지 항목만 보관하고 나머지는 페이지 사상표에 수록하여, 연관 사상표에 없을 때는 직접 사상 기법으로 변환
5. 페이징 기법의 특징
   - 메모리 보호는 페이지 단위로 이루어짐
   - 외부 단편화는 발생하지 않으나 내부 단편화는 발생할 수 있음

## 7.2.2 세그먼테이션 기법
1. 세그먼테이션 기법
   - 논리적 의미에 부합하는 크기의 블록으로 분할하여 관리하는 기법
   - 메모리 적재를 위해서는 최초 적합, 최적 적합 등의 방법 이용
2. 세그먼트 사상표
   - 페이지 사상표와 유사
   - 가상 주소의 세그먼트 번호별 저장 정보 : 실주소의 시작위치, 현재 메모리에 존재하는지의 여부 비트값, 보조기억장치의 주소, 세그먼트의 길이

## 7.2.3 페이징/세그먼테이션 혼용기법
1. 페이징/세그먼테이션 혼용기법
  - 세그먼테이션 기법의 논리적 장점과 페이징 기법의 메모리 관리 측면의 장점을 활용
  - 각 세그먼트를 다시 페이지 단위로 분할하고 메모리도 페이지 프레임으로 분할하여 하나의 페이지만 페이지 프레임에 적재하는 방식
  - 세그먼트 사상표에 저장되는 주소는 실주소가 아닌 각 세그먼트에 대한 페이지 사상표의 시작 주소

# 7.3 페이지 호출기법
1. 요구페이지 호출기법
   - 페이지가 요구될 때 해당 페이지를 메모리로 옮김
   - 페이지 결정에 대한 오버헤드가 최소화됨
2. 예상 페이지 호출기법
   - 필요한 페이지를 예상하여 미리 페이지를 메모리에 옮김
   - 예상이 옳았다면 실제로 필요한 시점이 되었을 때 프로세스 실행이 단절되지 않음

## 7.4 페이지 교체기법
1. 최적화 원칙
   - 최적의 성과를 얻기 위해 앞으로 가장 오랫동안 사용되지 않을 페이지를 교체 대상으로 선택
   - 미래를 예측할 수 없으므로 실제로 실현은 불가능
2. 페이지 고정
   - 효율적인 동작을 위해 어떤 페이지들은 교체가 일어나지 않도록 고정
   - 페이징을 위한 슈퍼바이저 코드 영역
   - 커널에 속하지 못한 보조기억장치 드라이버 영역
   - 시간을 맞춰 동작해야 하는 코드 영역
   - DMA 등에 의해 입출력장치로부터 직접 데이터가 교환되어야 하는 데이터 버퍼 영역 등
```
휴리스틱(Heuristics)이란,
문제를 해결하거나 불확실한 사항에 대해 판단을 내릴 필요가 있지만, 명확한 실마리가 없을 경우에 사용하는 편의적 발견적인 방법입니다. 다른 말로 표현하면 쉬운방법, 간편법, 발견법, 어림셈(어림짐작)이라고 말할 수 있습니다.
```

## 7.4.1 FIFO 페이지 교체
1. FIFO(First=In-First-Out) 페이지 교체 기법
   - 메모리 내에 가장 오래 있었던 페이지를 교체
   - 각 페이지가 메모리에 적재될 때마다 그때의 시간을 기억
   - FIFO 큐로 구현
2. 단점
   - Belady의 이상현상(anomaly): 프로세스에 더 많은 수의 페이지 프레임을 할당할 경우 오히려 페이지 부재가 더 많이 발생할 수 있는 경우

## 7.4.2 LRU 페이지 교체
1. LUR(Least Recently Used) 페이지 교체기법
   - 가장 오랫동안 사용되지 않은 페이지를 선택하여 교체
   - 최근의 상황이 가까운 미래에 대한 좋은 척도라는 국부성 휴리스틱에 의존하는 것
2. 국부성(locality)
   - 프로세스는 기억장치 내의 정보를 어느 한순간에 특정 부분을 집중적으로 참조한다는 것
   - 시간 국부성과 공간 국부성
3. 참조시간을 이용한 LRU 구현
   - 각 페이지가 참조될 때마다 그때의 시간을 테이블에 기록
   - 페이지를 엑세스하면 해당 페이지 번호를 리스트의 선두에 옮김
   - 교체가 필요한 경우 리스트의 끝에 있는 페이지가 교체 대상으로 선택
4. 리스트를 이용한 LRU 구현
   - 메모리에 적재된 페이지 번호를 저장하는 리스트를 이용
   - 페이지를 엑세스하면 해당 페이지 번호를 리스트의 선두에 옮김
   - 교체가 필요한 경우 리스트의 끝에 있는 페이지가 교체 대상으로 선택
5. 장점
   - Belady의 이상현상이 발생하지 않음
   - 최적화 원칙에 근사한 선택 가능
6. 단점
   - 경험적 판단이 맞지 않는 상황이 존재(여러 페이지로 구성되는 커다란 루프)
   - 막대한 오버헤드
  
## 7.4.3 LFU 페이지 교체
1. LFU(Least Frequetly Used)페이지 교체 기법
   - 참조된 횟수가 가장 적은 페이지가 교체
2. 단점
   - 가장 드물게 이용되는 페이지가 가장 최근에 메모리로 옮겨진 페이지일 가능성 있음
   - 초기에 매우 많이 사용된 후 더 이상 사용되지 않는 페이지는 불필요하게 메모리를 점유할 가능성 있음
  
## 7.4.4 NUR 페이지 교체
1. NUR(Not Used Recently) 페이지 교체기법
   - 적은 오버헤드로 적절한 성능
   - 참조 여부와 수정 여부에 따라 페이지들을 네 그룹으로 구분
   
